<!DOCTYPE html>
<html lang="ru">
 <head>
  <meta charset="utf-8">
  <title>Угол на единичной окружности</title>
  <link rel="icon" type="image/x-icon" href="icon.png">
  <style>
  </style>
  <script>

function strToRadians(angle,units) {
    if (units==="radians"){
        if (angle.includes('/')){
            let [num,den] = angle.split('/')
            if (num==="π"){
                return Math.PI/Number(den);
            }else if (num.endsWith("π")){
                return Number(num.substring(0,num.length-1))*Math.PI/Number(den);
            }else{
                return Number(num)/Number(den);
            }
        }
        if (angle==="π"){
            return Math.PI;
        }else if (angle.endsWith("π")){
            return Number(angle.substring(0,angle.length-1))*Math.PI;
        }else{
            return Number(angle);
        }
    }else if (units==='degrees'){
        return Number(angle)*(Math.PI/180)
    }else{
        throw new Error('unknown units '+units)
    }
}

function matchesFormat(input,units) {
    return (
        units==="degrees" && input.match(/^\d{1,3}(?:\.\d)?$/)||
        // 45 45.4
        units==="radians" && input.match(/^(?:\d{1,4}π?|π)(?:\/[1-9]\d{0,3})?$/)
        // 2 2pi 2pi/3 2/3 pi/2 pi
    );
}

function showOnCircle() {
    let angleStr = document.getElementById("angle").value;
    let unitsRadioList = document.getElementsByName("units");
    let units;
    for (let i = 0; i<unitsRadioList.length; i++){
        if (unitsRadioList[i].checked){
            units = unitsRadioList[i].value;
            break;
        }
    }
    let rusUnits;
    if (units==='degrees'){
        rusUnits='градусы';
    }else{
        rusUnits='радианы';
    }
    let log = "Введённое значение угла: "+angleStr+", мера измерения "+rusUnits;
    if (!matchesFormat(angleStr,units)) {
        log+="<br>Ошибка: входные данные не соответствуют формату";
        document.getElementById("log").innerHTML = log;
        clearCanvas();
        drawEmptyCircle();
        return;
    }
    document.getElementById("log").innerHTML = log;
    let angleInRadians = strToRadians(angleStr,units);
    clearCanvas();
    drawAngle(angleInRadians,angleStr,units);
    drawEmptyCircle();
}

function clearCanvas(){
    const canvas = document.getElementById('canvas');
    if (canvas.getContext) {
        const context = canvas.getContext('2d');
        context.clearRect(0, 0, canvas.width, canvas.height);
    }
}

function drawEmptyCircle(){
    const canvas = document.getElementById('canvas');
    if (canvas.getContext) {
        const context = canvas.getContext('2d');

        context.lineWidth = 1;
        context.strokeStyle = "black";

        context.beginPath(); // окружность
        context.arc(350,350,270,0,2*Math.PI)
        context.stroke();

        context.beginPath(); // абцисса
        context.moveTo(10, 350);
        context.lineTo(690, 350);
        context.lineTo(680, 355);
        context.moveTo(690, 350);
        context.lineTo(680, 345);

        context.moveTo(350, 690); // ордината
        context.lineTo(350, 10);
        context.lineTo(355, 20);
        context.moveTo(350, 10);
        context.lineTo(345, 20);
        context.stroke();

        context.textBaseline = 'alphabetic';
        context.textAlign = 'left';
        context.font = "24px Times New Roman"; // подписи
        context.fillStyle = "black";
        context.fillText('X', 680, 380);
        context.fillText('Y', 360, 20);
        context.font = "bold 24px Courier";
        context.fillText('0', 353, 370);
        context.fillText('1', 350+273, 370);
        context.fillText('1', 353, 350-275);
        context.fillText('-1', 350-303, 370);
        context.fillText('-1', 353, 350+290);
    }
}

function drawAngle(angleInRadians,angleStr,units){
    const canvas = document.getElementById('canvas');
    if (canvas.getContext) {
        const context = canvas.getContext('2d');

        context.lineWidth = 4; // сектор
        context.strokeStyle = "green";
        context.beginPath();
        const x = Math.floor(350+270*Math.cos(angleInRadians));
        const y = Math.floor(350-270*Math.sin(angleInRadians));

        context.lineWidth = 1;
        context.moveTo(350, 350);
        context.lineTo(x, y);
        context.arc(350,350,270,-angleInRadians,0)
        context.moveTo(350+270, 350);
        context.lineTo(350, 350);
        context.fillStyle = '#9DEC9D';
        context.fill();
        context.stroke();
        
        context.lineWidth = 4;
        context.beginPath();
        context.moveTo(350, 350);
        context.lineTo(x, y);
        context.stroke();

        context.beginPath();
        context.arc(350,350,270,-angleInRadians,0)
        context.stroke();

        context.beginPath();
        context.moveTo(350+270, 350);
        context.lineTo(350, 350);
        context.stroke();

        context.textBaseline = 'alphabetic';
        context.font = "28px Times New Roman";
        context.fillStyle = 'black';
        if (Math.PI/2 <= angleInRadians%(Math.PI*2) && angleInRadians%(Math.PI*2) <= Math.PI/2*3) {
            context.textAlign = "right"
        }else{
            context.textAlign = "left"
        }
        if (0<=angleInRadians%(Math.PI*2) && angleInRadians%(Math.PI*2)<=Math.PI) {
            context.textBaseline = "bottom"
        }else{
            context.textBaseline = "top"
        }
        let textAngle = angleInRadians%(Math.PI*2);
        if (87/180*Math.PI<textAngle && textAngle<Math.PI/2){
            textAngle=87/180*Math.PI;
        }else if (Math.PI<textAngle && textAngle<185/180*Math.PI) {
            textAngle=185/180*Math.PI;
        }else if (3*Math.PI/2<textAngle && textAngle<277/180*Math.PI) {
            textAngle=277/180*Math.PI;
        }else if (354/180*Math.PI<textAngle && textAngle<2*Math.PI) {
            textAngle=354/180*Math.PI;
        }
        let x0 = Math.floor(350+280*Math.cos(textAngle));
        let y0 = Math.floor(350-280*Math.sin(textAngle));
        if (units==='degrees'){
            context.fillText(angleStr+'°', x0, y0);
        }else{
            if (angleStr.includes('/')){
                let [num,den] = angleStr.split('/');
                context.textBaseline = 'bottom';
                const numMetrics = context.measureText(num);
                const denMetrics = context.measureText(den);
                const numWidth = numMetrics.width;
                const numHeight = Math.abs(numMetrics.actualBoundingBoxAscent-numMetrics.actualBoundingBoxDescent);
                const denWidth = denMetrics.width;
                const denHeight = Math.abs(denMetrics.actualBoundingBoxAscent-denMetrics.actualBoundingBoxDescent);
                const maxWidth = Math.max(numWidth,denWidth);
                context.textAlign = 'center';
                context.lineWidth = 1;
                context.strokeStyle = "black";
                if (0<=angleInRadians%(Math.PI*2) && angleInRadians%(Math.PI*2)<Math.PI/2){
                    context.textBaseline = 'bottom';
                    context.fillText(den, x0+maxWidth/2, y0);
                    context.fillText(num, x0+maxWidth/2, y0-denHeight);
                    context.beginPath();
                    context.moveTo(x0, y0-denHeight);
                    context.lineTo(x0+maxWidth, y0-denHeight);
                    context.stroke();
                }else if (Math.PI/2<=angleInRadians%(Math.PI*2) && angleInRadians%(Math.PI*2)<=Math.PI){
                    context.textBaseline = 'bottom';
                    context.fillText(den, x0-maxWidth/2, y0);
                    context.fillText(num, x0-maxWidth/2, y0-denHeight);
                    context.beginPath();
                    context.moveTo(x0, y0-denHeight);
                    context.lineTo(x0-maxWidth, y0-denHeight);
                    context.stroke();
                }else if (Math.PI<angleInRadians%(Math.PI*2) && angleInRadians%(Math.PI*2)<=3*Math.PI/2){
                    context.textBaseline = 'top';
                    context.fillText(num, x0-maxWidth/2, y0);
                    context.fillText(den, x0-maxWidth/2, y0+numHeight);
                    context.beginPath();
                    context.moveTo(x0, y0+numHeight-3);
                    context.lineTo(x0-maxWidth, y0+numHeight-3);
                    context.stroke();
                }else{
                    context.textBaseline = 'top';
                    context.fillText(num, x0+maxWidth/2, y0);
                    context.fillText(den, x0+maxWidth/2, y0+numHeight);
                    context.beginPath();
                    context.moveTo(x0, y0+numHeight-3);
                    context.lineTo(x0+maxWidth, y0+numHeight-3);
                    context.stroke();
                }
            }else{
                context.fillText(angleStr, x0, y0);
            }
        }
    }
}

function addPi(){
    const input = document.getElementById("angle");
    const pos = input.selectionStart;
    if (!input.value.includes('π')){
        input.value=input.value.substring(0,pos)+'π'+input.value.substring(pos);
    }
    input.focus();
}

window.addEventListener("load", (event) => {
    clearCanvas();
    drawEmptyCircle();
    const input = document.getElementById('angle');
    input.addEventListener("keyup", ({key}) => {
        if (key === "Enter") {
            showOnCircle();
        }
    });
    input.addEventListener("keypress", (e) => {
        const c = String.fromCharCode(e.keyCode);
        if (c === "p" || c==="P" || c==="з" || c==="З" || c === "п" || c==="П" || c==="g" || c==="G") {
            addPi();
            e.preventDefault();
        }
    });
});

  </script>
 </head>
 <body>
  <div style="display: inline-block;">
   <h1 style="text-align: center;">Угол на единичной окружности</h1>
   <div>
    <div style="display: inline-block; vertical-align: middle;">
     <canvas id="canvas" width="700" height="700"></canvas>
    </div>
   </div>
   <div>
    <input type="radio" id="degrees" name="units" value="degrees" checked />
    <label for="degrees">Градусы</label>
   </div>
   <div>
    <input type="radio" id="radians" name="units" value="radians" />
    <label for="radians">Радианы</label>
   </div>
   <p>Введите значение угла: <input id="angle" type="text">&nbsp;<input type="button" onclick="addPi()" value="π"></p>
   <p><input type="button" onclick="showOnCircle()" value="Отобразить на окружности"></p>
   <p id="log"></p>
 </body>
</html>
